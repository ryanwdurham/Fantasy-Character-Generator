<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Character Creator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .creator-panel, .preview-panel {
            background: rgba(255, 255, 255, 0.08);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.3em;
            color: #feca57;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(254, 202, 87, 0.3);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #48dbfb;
            font-weight: 500;
        }

        input[type="text"], select {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 1em;
            transition: all 0.3s;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #48dbfb;
            background: rgba(0, 0, 0, 0.6);
        }

        select option {
            background: #1a1a2e;
            color: #fff;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        button {
            flex: 1;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .generate-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            color: white;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
        }

        .randomize-btn {
            background: linear-gradient(45deg, #48dbfb, #0abde3);
            color: white;
        }

        .randomize-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(72, 219, 251, 0.4);
        }

        .download-btn {
            background: linear-gradient(45deg, #feca57, #ff9ff3);
            color: #1a1a2e;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(254, 202, 87, 0.4);
        }

        .character-display {
            text-align: center;
        }

        .portrait-container {
            width: 100%;
            aspect-ratio: 3/4;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            position: relative;
        }

        .portrait-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .placeholder {
            color: #666;
            font-size: 1.2em;
        }

        .character-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            text-align: left;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #feca57;
        }

        .stat-label {
            color: #48dbfb;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.1em;
        }

        .bio-section {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            line-height: 1.6;
        }

        .abilities-section {
            margin-top: 15px;
        }

        .ability-item {
            background: rgba(255, 107, 107, 0.2);
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 3px solid #ff6b6b;
        }

        .loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #48dbfb;
            font-size: 1.2em;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid #48dbfb;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    @media (max-width: 968px) {
    .main-content {
        grid-template-columns: 1fr;
    }

    h1 {
        font-size: 2em;
    }

    .button-group {
        flex-direction: column;
    }
}

@media (max-width: 968px) and (orientation: landscape) {
    .name-input-group {
        display: flex;
        gap: 8px;
    }
    
    .name-input-group input {
        flex: 1;
    }
    
    .name-input-group button {
        flex: 0 0 auto;
        padding: 10px 12px !important;
        font-size: 0.85em !important;
        white-space: nowrap;
        min-width: 80px;
        max-width: 100px;
    }
}

    h1 {
        font-size: 2em;
    }

    .button-group {
        flex-direction: column;
    }
}

@media (max-width: 968px) and (orientation: landscape) {
    .name-input-group {
        display: flex;
        gap: 8px;
    }
    
    .name-input-group input {
        flex: 1;
    }
    
    .name-input-group button {
        flex: 0 0 auto;
        padding: 10px 12px !important;
        font-size: 0.85em !important;
        white-space: nowrap;
        min-width: 80px;
        max-width: 100px;
    }
}
        .error-message {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #ff6b6b;
            display: none;
        }

        .error-message.active {
            display: block;
        }

        .weapon-description, .companion-description {
            margin-top: 15px;
            padding: 15px;
            background: rgba(72, 219, 251, 0.1);
            border-radius: 8px;
            border-left: 3px solid #48dbfb;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öîÔ∏è Fantasy Character Creator ‚öîÔ∏è</h1>
            <p class="subtitle">Forge your legendary hero and bring them to life</p>
        </header>

        <div class="main-content">
            <div class="creator-panel">
                <div class="section">
                    <h2 class="section-title">Basic Information</h2>
                    <div class="form-group">
                        <label>Character Name</label>
                       <div class="name-input-group" style="display: flex; gap: 8px;">
    <input type="text" id="charName" placeholder="Enter name or leave blank" style="flex: 2;">
    <button onclick="generateRandomName()" style="padding: 12px 15px; background: linear-gradient(45deg, #ff9ff3, #feca57); color: #1a1a2e; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; white-space: nowrap; flex-shrink: 0;">üé≤ Random Name</button>
</div>
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="gender">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="neutral">Neutral/Androgynous</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Race</label>
                        <select id="race">
                            <option value="human">Human</option>
                            <option value="elf">High Elf</option>
                            <option value="dark-elf">Dark Elf</option>
                            <option value="forest-elf">Forest Elf</option>
                            <option value="dwarf">Dwarf</option>
                            <option value="orc">Orc</option>
                            <option value="tiefling">Tiefling</option>
                            <option value="dragonborn">Dragonborn</option>
                            <option value="undead">Undead</option>
                            <option value="goblin">Goblin</option>
                            <option value="minotaur">Minotaur</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Class</label>
                        <select id="class">
                            <option value="warrior">Warrior</option>
                            <option value="rogue">Rogue</option>
                            <option value="paladin">Paladin</option>
                            <option value="ranger">Ranger</option>
                            <option value="mage">Mage</option>
                            <option value="warlock">Warlock</option>
                            <option value="cleric">Cleric</option>
                            <option value="assassin">Assassin</option>
                            <option value="druid">Druid</option>
                            <option value="shaman">Shaman</option>
                            <option value="monk">Monk</option>
                            <option value="necromancer">Necromancer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Alignment</label>
                        <select id="alignment">
                            <option value="good">Good</option>
                            <option value="neutral">Neutral</option>
                            <option value="evil">Evil</option>
                        </select>
                    </div>
                </div>

                <div class="section">
                    <h2 class="section-title">Appearance</h2>
                    <div class="form-group">
                        <label>Hair Color</label>
                        <select id="hairColor">
                            <option value="black">Black</option>
                            <option value="brown">Brown</option>
                            <option value="blonde">Blonde</option>
                            <option value="red">Red</option>
                            <option value="white">White</option>
                            <option value="silver">Silver</option>
                            <option value="blue">Blue</option>
                            <option value="purple">Purple</option>
                            <option value="green">Green</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Eye Color</label>
                        <select id="eyeColor">
                            <option value="brown">Brown</option>
                            <option value="blue">Blue</option>
                            <option value="green">Green</option>
                            <option value="amber">Amber</option>
                            <option value="grey">Grey</option>
                            <option value="red">Red</option>
                            <option value="purple">Purple</option>
                            <option value="gold">Gold</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Armor Style</label>
                        <select id="armorStyle">
                            <option value="heavy-plate">Heavy Plate Armor</option>
                            <option value="leather">Leather Armor</option>
                            <option value="robes">Mystical Robes</option>
                            <option value="chainmail">Chainmail</option>
                            <option value="light-armor">Light Armor</option>
                            <option value="tribal">Tribal Garments</option>
                        </select>
                    </div>
                </div>

                <div class="section">
                    <h2 class="section-title">Personality</h2>
                    <div class="form-group">
                        <label>Personality Trait</label>
                        <select id="personality">
                            <option value="brave">Brave - Fearless in the face of danger</option>
                            <option value="mysterious">Mysterious - Enigmatic and secretive</option>
                            <option value="kind">Kind - Compassionate and caring</option>
                            <option value="cunning">Cunning - Clever and strategic</option>
                            <option value="ruthless">Ruthless - Merciless and brutal</option>
                            <option value="wise">Wise - Knowledgeable and insightful</option>
                            <option value="chaotic">Chaotic - Unpredictable and wild</option>
                            <option value="noble">Noble - Honorable and dignified</option>
                            <option value="vengeful">Vengeful - Driven by retribution</option>
                            <option value="ambitious">Ambitious - Power-hungry and driven</option>
                            <option value="melancholic">Melancholic - Haunted by past sorrows</option>
                            <option value="optimistic">Optimistic - Hopeful and positive</option>
                            <option value="stoic">Stoic - Unemotional and disciplined</option>
                            <option value="rebellious">Rebellious - Defiant and independent</option>
                            <option value="protective">Protective - Guardian of the weak</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Background Origin</label>
                        <select id="background">
                            <option value="ruined-city">Born in a Ruined City</option>
                            <option value="raised-by-dragons">Raised by Dragons</option>
                            <option value="orphan">Street Orphan</option>
                            <option value="noble-house">Noble House</option>
                            <option value="forest-wilds">Forest Wilds</option>
                            <option value="monastery">Ancient Monastery</option>
                            <option value="cursed">Cursed Bloodline</option>
                            <option value="shipwrecked">Shipwrecked Survivor</option>
                            <option value="war-torn">War-Torn Homeland</option>
                            <option value="enslaved">Former Slave</option>
                            <option value="exile">Exiled from Kingdom</option>
                            <option value="mountain-peak">Isolated Mountain Peak</option>
                            <option value="desert-nomad">Desert Nomad Tribe</option>
                            <option value="underground">Deep Underground Caverns</option>
                            <option value="pirate">Pirate Ship Crew</option>
                            <option value="circus">Traveling Circus</option>
                            <option value="haunted">Haunted Manor</option>
                            <option value="prophecy">Born from Prophecy</option>
                        </select>
                    </div>
                </div>

                <div class="button-group">
                    <button class="randomize-btn" onclick="randomizeCharacter()">üé≤ Randomize</button>
                    <button class="generate-btn" onclick="generateCharacter()">‚ö° Create Character</button>
                </div>

                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="preview-panel">
                <div class="character-display">
                    <div class="portrait-container" id="portraitContainer">
                        <div class="placeholder">Your character portrait will appear here</div>
                        <div class="loading" id="loadingSpinner">
                            <div class="spinner"></div>
                            <div>Generating portrait...</div>
                        </div>
                    </div>
                    
                    <div class="character-info" id="characterInfo" style="display: none;">
                        <h2 id="displayName" style="color: #feca57; margin-bottom: 15px;"></h2>
                        
                        <div class="stat-grid">
                            <div class="stat-item">
                                <div class="stat-label">Race</div>
                                <div class="stat-value" id="displayRace"></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Class</div>
                                <div class="stat-value" id="displayClass"></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Alignment</div>
                                <div class="stat-value" id="displayAlignment"></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Element</div>
                                <div class="stat-value" id="displayElement"></div>
                            </div>
                        </div>

                        <div class="stat-grid">
                            <div class="stat-item">
                                <div class="stat-label">Strength</div>
                                <div class="stat-value" id="statStr"></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Agility</div>
                                <div class="stat-value" id="statAgi"></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Intelligence</div>
                                <div class="stat-value" id="statInt"></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Charisma</div>
                                <div class="stat-value" id="statCha"></div>
                            </div>
                        </div>

                        <div class="bio-section">
                            <h3 style="color: #48dbfb; margin-bottom: 10px;">Biography</h3>
                            <p id="displayBio"></p>
                        </div>

                        <div class="weapon-description">
                            <h3 style="color: #feca57; margin-bottom: 10px;">‚öîÔ∏è Weapon</h3>
                            <div style="font-weight: bold; margin-bottom: 5px;" id="displayWeapon"></div>
                            <div id="weaponDesc"></div>
                        </div>

                        <div class="companion-description" id="companionSection" style="display: none;">
                            <h3 style="color: #ff9ff3; margin-bottom: 10px;">üêæ Companion</h3>
                            <div style="font-weight: bold; margin-bottom: 5px;" id="displayCompanion"></div>
                            <div id="companionDesc"></div>
                        </div>

                        <div class="abilities-section">
                            <h3 style="color: #ff6b6b; margin-bottom: 10px;">Special Abilities</h3>
                            <div id="abilitiesList"></div>
                        </div>

                        <button class="download-btn" onclick="downloadCharacter()" style="width: 100%; margin-top: 20px;">
                            üíæ Download Character Card
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const characterData = {
            names: {
                male: ['Aldric', 'Thorne', 'Kael', 'Draven', 'Roran', 'Gareth', 'Varian', 'Mordred', 'Zephyr', 'Talon', 'Ragnar', 'Caspian'],
                female: ['Lyra', 'Seraphina', 'Elara', 'Astrid', 'Ravenna', 'Isolde', 'Nyx', 'Aria', 'Morrigan', 'Vesper', 'Calista', 'Ember'],
                neutral: ['Ash', 'Quinn', 'Raven', 'Storm', 'Phoenix', 'Echo', 'Sage', 'Nova', 'Cipher', 'Onyx', 'Vale', 'Wraith']
            },
            elements: {
                warrior: null,
                rogue: null,
                paladin: 'light',
                ranger: 'nature',
                mage: ['fire', 'ice', 'arcane', 'storm'],
                warlock: ['shadow', 'fire', 'arcane'],
                cleric: 'light',
                assassin: 'shadow',
                druid: ['nature', 'earth', 'storm'],
                shaman: ['earth', 'storm', 'nature'],
                monk: null,
                necromancer: 'shadow'
            },
            weapons: {
                warrior: [
                    {name: 'Greatsword of the Fallen King', desc: 'A massive two-handed blade forged in ancient fires, its edge never dulls and carries the weight of countless victories.'},
                    {name: 'Longsword & Tower Shield', desc: 'A perfectly balanced sword paired with an impenetrable shield emblazoned with your family crest, offering both offense and defense.'},
                    {name: 'Battle Axe of Thunder', desc: 'A heavy war axe that crackles with energy upon impact, capable of cleaving through armor and bone alike.'}
                ],
                rogue: [
                    {name: 'Twin Shadow Daggers', desc: 'Obsidian blades that seem to drink in light, these daggers strike silently and leave no trace behind.'},
                    {name: 'Venom-Tipped Short Sword', desc: 'A swift blade coated in a paralytic toxin, perfect for quick strikes and hasty retreats.'},
                    {name: 'Crimson Rapier', desc: 'An elegant dueling blade that moves like water, finding gaps in armor with supernatural precision.'}
                ],
                paladin: [
                    {name: 'Holy Avenger & Radiant Shield', desc: 'A blessed longsword that glows with divine light, paired with a shield that can deflect both physical and magical attacks.'},
                    {name: 'Blessed Mace of Justice', desc: 'A ceremonial weapon infused with holy power, especially devastating against undead and demonic foes.'}
                ],
                ranger: [
                    {name: 'Longbow of the Eagle Eye', desc: 'An enchanted bow crafted from ancient heartwood, its arrows never miss their mark and can strike targets beyond normal sight.'},
                    {name: 'Crossbow of Swift Death', desc: 'A mechanical masterpiece that fires three bolts simultaneously, reloading with supernatural speed.'}
                ],
                mage: [
                    {name: 'Staff of Eternal Elements', desc: 'A towering staff crowned with a pulsing crystal that amplifies your magical power tenfold, channeling the raw forces of nature.'},
                    {name: 'Arcane Wand of Stars', desc: 'A slender wand carved from moonstone that allows you to cast spells with precision and reduced strain on your mana reserves.'}
                ],
                warlock: [
                    {name: 'Staff of the Damned', desc: 'A twisted staff made from petrified wood from the underworld, it hungers for souls and grows stronger with each life taken.'},
                    {name: 'Soul Reaver Blade', desc: 'A sword forged from crystallized darkness that can sever both flesh and spirit, trapping souls within its edge.'}
                ],
                cleric: [
                    {name: 'Staff of Divine Healing', desc: 'A sacred staff topped with a glowing crystal that channels healing energy and can banish undead with a touch.'},
                    {name: 'Mace of Righteous Fury', desc: 'A blessed weapon that protects allies while smiting enemies with holy fire.'}
                ],
                assassin: [
                    {name: 'Hidden Wrist Blades', desc: 'Spring-loaded retractable blades concealed in your bracers, perfect for silent eliminations and surprise attacks.'},
                    {name: 'Widows Kiss Dagger', desc: 'A black blade coated in the deadliest poison known to mortals, a single cut means certain death within minutes.'}
                ],
                druid: [
                    {name: 'Living Wood Staff', desc: 'A staff that still grows and blooms, connected to the heart of the forest itself, commanding nature with each gesture.'},
                    {name: 'Primal Club of the Bear', desc: 'A massive wooden club infused with the strength of ancient bears, it can summon vines to entangle foes.'}
                ],
                shaman: [
                    {name: 'Totem Staff of Ancestors', desc: 'A staff adorned with carved totems of your tribal ancestors, channeling their wisdom and elemental fury.'},
                    {name: 'Thunder Hammer of Storms', desc: 'A weapon blessed by storm spirits, each strike calls down lightning and thunder upon your enemies.'}
                ],
                monk: [
                    {name: 'Fists of Iron Will', desc: 'Your body is your weapon, conditioned through decades of training to strike harder than steel and block any blade.'},
                    {name: 'Bo Staff of Balance', desc: 'A simple wooden staff that becomes an extension of your body, capable of deflecting arrows and shattering bones.'}
                ],
                necromancer: [
                    {name: 'Deaths Scythe', desc: 'A massive scythe that reaps souls as easily as wheat, it allows you to harvest life force from the dying.'},
                    {name: 'Bone Staff of Eternal Night', desc: 'A staff constructed from the bones of ancient liches, pulsing with necromantic energy and the whispers of the dead.'}
                ]
            },
            companions: {
                ranger: [
                    {name: 'Shadow Wolf', desc: 'A massive black wolf with intelligence in its amber eyes. It has been your loyal companion since you saved it as a pup, and it would die protecting you.'},
                    {name: 'Crimson Hawk', desc: 'A majestic hunting hawk with blood-red plumage that can spot prey from miles away. It delivers messages and scouts ahead.'},
                    {name: 'Midnight Panther', desc: 'A sleek black panther that moves like liquid shadow. Silent and deadly, it stalks your enemies and attacks with lethal precision.'}
                ],
                necromancer: [
                    {name: 'Skeletal Servant', desc: 'A reassembled skeleton warrior bound to your will, it serves as both bodyguard and messenger with unwavering loyalty.'},
                    {name: 'Spectral Hound', desc: 'A ghostly hound that exists between life and death, phasing through walls and tracking souls across vast distances.'},
                    {name: 'Undead Raven', desc: 'A rotting raven animated by dark magic that serves as your eyes and ears, speaking with the voices of the dead.'}
                ],
                druid: [
                    {name: 'Ancient Bear Spirit', desc: 'A colossal bear infused with the essence of the old forest. It has protected these woods for centuries and chose you as its companion.'},
                    {name: 'Forest Guardian Owl', desc: 'A mystical owl with feathers that shimmer like leaves in moonlight. It sees all secrets of the forest.'},
                    {name: 'Moonlight Stag', desc: 'A white stag with antlers that glow softly in darkness. This noble creature guides you through any terrain.'}
                ],
                mage: [
                    {name: 'Arcane Familiar', desc: 'A small creature of pure magical energy that changes form based on your mood. It helps you focus spells.'},
                    {name: 'Phoenix Hatchling', desc: 'A young phoenix whose flames never burn you. It is reborn from its ashes and shares its immortal fire with you.'},
                    {name: 'Frost Pseudo-Dragon', desc: 'A miniature dragon with scales of ice that perches on your shoulder. It breathes freezing mist and can sense magical danger.'}
                ],
                warlock: [
                    {name: 'Imp Familiar', desc: 'A mischievous demon bound by your pact. The imp scouts ahead, spreads chaos among enemies, and whispers dark secrets.'},
                    {name: 'Shadow Demon', desc: 'A creature born from living darkness that dwells in your shadow. It emerges to attack your foes with claws of pure void.'},
                    {name: 'Void Serpent', desc: 'A serpentine entity from beyond reality that coils around you invisibly, striking enemies from impossible angles.'}
                ]
            }
        };

async function generateRandomName() {
    const gender = document.getElementById('gender').value;
    const race = document.getElementById('race').value;
    
    // Expanded name lists with 60+ names each
    const nameDatabase = {
        male: ['Aldric', 'Thorne', 'Kael', 'Draven', 'Roran', 'Gareth', 'Varian', 'Mordred', 'Zephyr', 'Talon', 'Ragnar', 'Caspian', 'Dorian', 'Finnian', 'Lucian', 'Corvus', 'Soren', 'Magnus', 'Cedric', 'Alaric', 'Theron', 'Cassius', 'Darius', 'Eamon', 'Rowan', 'Viktor', 'Lysander', 'Brennan', 'Kieran', 'Tristan', 'Gideon', 'Maximus', 'Caelum', 'Evander', 'Orin', 'Silas', 'Rhys', 'Bastian', 'Corvin', 'Zarek', 'Aldous', 'Balthazar', 'Fenris', 'Galen', 'Hadrian', 'Ignatius', 'Jareth', 'Kyros', 'Leander', 'Malakai', 'Naveen', 'Oberon', 'Perseus', 'Quintus', 'Rafferty', 'Sterling', 'Tavian', 'Ulric', 'Valerian', 'Wolfric', 'Xander', 'Yuri', 'Zander'],
        female: ['Lyra', 'Seraphina', 'Elara', 'Astrid', 'Ravenna', 'Isolde', 'Nyx', 'Aria', 'Morrigan', 'Vesper', 'Calista', 'Ember', 'Celeste', 'Diana', 'Freya', 'Sable', 'Luna', 'Vespera', 'Zara', 'Thalia', 'Iris', 'Selene', 'Rhiannon', 'Elowen', 'Cordelia', 'Briar', 'Aurelia', 'Octavia', 'Lysandra', 'Celestia', 'Lilith', 'Morgana', 'Rowena', 'Sabrina', 'Ophelia', 'Evangeline', 'Isadora', 'Vivienne', 'Genevieve', 'Arabella', 'Marcella', 'Lenora', 'Cassandra', 'Bellatrix', 'Cerys', 'Delilah', 'Evelina', 'Fiona', 'Guinevere', 'Helena', 'Iliana', 'Juliana', 'Katerina', 'Lorelei', 'Melisande', 'Natalia', 'Ondine', 'Persephone', 'Quintessa', 'Rosalind', 'Seraphine', 'Tatiana', 'Ursula', 'Valentina', 'Winifred', 'Xena', 'Yvaine', 'Zelda'],
        neutral: ['Ash', 'Quinn', 'Raven', 'Storm', 'Phoenix', 'Echo', 'Sage', 'Nova', 'Cipher', 'Onyx', 'Vale', 'Wraith', 'River', 'Sky', 'Frost', 'Shadow', 'Ember', 'Haven', 'North', 'Atlas', 'Cedar', 'Rowan', 'Sparrow', 'Winter', 'Sterling', 'Indigo', 'Marlowe', 'Aurelian', 'Camden', 'Cypress', 'Dakota', 'Ellis', 'Finley', 'Gray', 'Harper', 'Justice', 'Kai', 'Lux', 'Meridian', 'Noble', 'Ocean', 'Parker', 'Quest', 'Rain', 'Sable', 'Tate', 'Unity', 'Vega', 'Wilder', 'Xen', 'Yarrow', 'Zenith']
    };
    
    // Procedurally generate additional names
    const syllables = {
        male: {
            start: ['Ael', 'Bor', 'Cor', 'Dar', 'Eld', 'Fen', 'Gor', 'Har', 'Jor', 'Kor', 'Lor', 'Mor', 'Nar', 'Rad', 'Thal', 'Var', 'Zar'],
            middle: ['an', 'ar', 'en', 'or', 'in', 'on', 'un', 'al', 'el', 'il'],
            end: ['ic', 'on', 'us', 'is', 'as', 'os', 'ian', 'rick', 'gar', 'dor', 'mir', 'ath', 'ius']
        },
        female: {
            start: ['Ae', 'Al', 'Ar', 'Bel', 'Cel', 'Del', 'El', 'Ev', 'Fen', 'Is', 'Lil', 'Ly', 'Mel', 'Nes', 'Ros', 'Sel', 'Ves'],
            middle: ['a', 'e', 'i', 'ae', 'ia', 'ara', 'ela', 'ira', 'ora'],
            end: ['ra', 'na', 'la', 'sa', 'da', 'lyn', 'wen', 'yn', 'ine', 'elle', 'ette', 'aria']
        },
        neutral: {
            start: ['Ash', 'Cy', 'Dex', 'Echo', 'Jax', 'Kai', 'Lux', 'Nyx', 'Onyx', 'Pax', 'Quin', 'Rax', 'Sable', 'Vex', 'Zeph'],
            middle: ['', 'en', 'ar', 'or'],
            end: ['', 'is', 'us', 'ex', 'ix', 'yn', 'el']
        }
    };
    
    // Generate procedural name
    const genderSyllables = syllables[gender];
    const proceduralName = 
        genderSyllables.start[Math.floor(Math.random() * genderSyllables.start.length)] +
        genderSyllables.middle[Math.floor(Math.random() * genderSyllables.middle.length)] +
        genderSyllables.end[Math.floor(Math.random() * genderSyllables.end.length)];
    
    // Combine database and procedural - randomly choose one
    const allNames = [...nameDatabase[gender], proceduralName];
    const randomName = allNames[Math.floor(Math.random() * allNames.length)];
    
    document.getElementById('charName').value = randomName;
}

        function randomizeCharacter() {
            const genders = ['male', 'female', 'neutral'];
            const races = Array.from(document.getElementById('race').options).map(o => o.value);
            const classes = Array.from(document.getElementById('class').options).map(o => o.value);
            const alignments = ['good', 'neutral', 'evil'];
            const hairColors = Array.from(document.getElementById('hairColor').options).map(o => o.value);
            const eyeColors = Array.from(document.getElementById('eyeColor').options).map(o => o.value);
            const armorStyles = Array.from(document.getElementById('armorStyle').options).map(o => o.value);
            const personalities = Array.from(document.getElementById('personality').options).map(o => o.value);
            const backgrounds = Array.from(document.getElementById('background').options).map(o => o.value);

            document.getElementById('gender').value = genders[Math.floor(Math.random() * genders.length)];
            document.getElementById('race').value = races[Math.floor(Math.random() * races.length)];
            document.getElementById('class').value = classes[Math.floor(Math.random() * classes.length)];
            document.getElementById('alignment').value = alignments[Math.floor(Math.random() * alignments.length)];
            document.getElementById('hairColor').value = hairColors[Math.floor(Math.random() * hairColors.length)];
            document.getElementById('eyeColor').value = eyeColors[Math.floor(Math.random() * eyeColors.length)];
            document.getElementById('armorStyle').value = armorStyles[Math.floor(Math.random() * armorStyles.length)];
            document.getElementById('personality').value = personalities[Math.floor(Math.random() * personalities.length)];
            document.getElementById('background').value = backgrounds[Math.floor(Math.random() * backgrounds.length)];
            document.getElementById('charName').value = '';
        }

        function getElement(charClass) {
            const element = characterData.elements[charClass];
            if (!element) return 'None';
            if (Array.isArray(element)) {
                return element[Math.floor(Math.random() * element.length)];
            }
            return element;
        }

        function getWeapon(charClass) {
            const weapons = characterData.weapons[charClass];
            return weapons[Math.floor(Math.random() * weapons.length)];
        }

        function getCompanion(charClass) {
            const companions = characterData.companions[charClass];
            if (!companions) return null;
            return companions[Math.floor(Math.random() * companions.length)];
        }

        function generateStats(charClass, race) {
            let str = 10, agi = 10, int = 10, cha = 10;

            if (['warrior', 'paladin', 'monk'].includes(charClass)) {
                str += Math.floor(Math.random() * 6) + 5;
                agi += Math.floor(Math.random() * 4) + 2;
            } else if (['rogue', 'assassin', 'ranger'].includes(charClass)) {
                agi += Math.floor(Math.random() * 6) + 5;
                str += Math.floor(Math.random() * 4) + 2;
            } else if (['mage', 'warlock', 'necromancer'].includes(charClass)) {
                int += Math.floor(Math.random() * 6) + 5;
                cha += Math.floor(Math.random() * 4) + 2;
            } else if (['cleric', 'druid', 'shaman'].includes(charClass)) {
                int += Math.floor(Math.random() * 5) + 3;
                cha += Math.floor(Math.random() * 5) + 3;
                str += Math.floor(Math.random() * 3) + 2;
            }

            if (['dwarf', 'orc', 'minotaur'].includes(race)) str += 3;
            if (['elf', 'dark-elf', 'forest-elf'].includes(race)) agi += 3;
            if (['human', 'tiefling'].includes(race)) cha += 2;

            return { str, agi, int, cha };
        }

        function generateAbilities(charClass, race, element) {
            const abilities = [];
            
            if (charClass === 'warrior') {
                abilities.push('Devastating Strike: Deals massive damage with melee weapons');
                abilities.push('Iron Defense: Reduces incoming damage significantly');
                abilities.push('Battle Cry: Rallies allies and intimidates enemies');
            } else if (charClass === 'rogue') {
                abilities.push('Shadow Step: Teleport short distances through shadows');
                abilities.push('Critical Strike: Increased critical hit chance from behind');
                abilities.push('Evasion: Dodge incoming attacks with supernatural agility');
            } else if (charClass === 'mage') {
                abilities.push(`${element.charAt(0).toUpperCase() + element.slice(1)} Mastery: Command devastating ${element} spells`);
                abilities.push('Arcane Shield: Create a magical barrier of protection');
                abilities.push('Mana Surge: Temporarily boost spell power dramatically');
            } else if (charClass === 'ranger') {
                abilities.push('Eagle Eye: See and shoot targets at extreme distances');
                abilities.push('Nature\'s Bond: Communicate with animals and plants');
                abilities.push('Hunter\'s Mark: Track and deal bonus damage to marked targets');
            } else if (charClass === 'paladin') {
                abilities.push('Divine Smite: Channel holy energy into devastating attacks');
                abilities.push('Lay on Hands: Heal wounds with sacred touch');
                abilities.push('Aura of Protection: Shield allies from harm');
            } else if (charClass === 'necromancer') {
                abilities.push('Raise Dead: Summon skeletal warriors to fight');
                abilities.push('Life Drain: Steal life force from enemies');
                abilities.push('Death\'s Touch: Inflict necrotic damage and curses');
            } else if (charClass === 'druid') {
                abilities.push('Wild Shape: Transform into powerful beasts');
                abilities.push('Nature\'s Wrath: Summon vines and thorns to entangle foes');
                abilities.push('Healing Circle: Restore health to all nearby allies');
            } else if (charClass === 'warlock') {
                abilities.push('Eldritch Blast: Fire bolts of dark energy');
                abilities.push('Dark Pact: Draw power from otherworldly entities');
                abilities.push('Hex: Curse enemies with weakening magic');
            } else if (charClass === 'assassin') {
                abilities.push('Silent Kill: Execute unaware targets instantly');
                abilities.push('Poison Master: Coat weapons in lethal toxins');
                abilities.push('Vanish: Become invisible for a short duration');
            } else if (charClass === 'cleric') {
                abilities.push('Divine Healing: Powerful restoration magic');
                abilities.push('Smite Evil: Deal holy damage to dark creatures');
                abilities.push('Sacred Shield: Protect allies with divine barriers');
            } else if (charClass === 'shaman') {
                abilities.push('Elemental Fury: Summon lightning and earthquakes');
                abilities.push('Spirit Walk: Commune with ancestral spirits');
                abilities.push('Totemic Power: Place totems that buff allies');
            } else if (charClass === 'monk') {
                abilities.push('Flurry of Blows: Unleash a barrage of rapid strikes');
                abilities.push('Ki Strike: Channel inner energy into devastating attacks');
                abilities.push('Diamond Body: Resist poisons and disease');
            }

            return abilities;
        }

       async function generateBio(name, race, charClass, background, personality, alignment, element, gender) {
    const pronoun = gender === 'male' ? 'he' : gender === 'female' ? 'she' : 'they';
    const possessive = gender === 'male' ? 'his' : gender === 'female' ? 'her' : 'their';
    const object = gender === 'male' ? 'him' : gender === 'female' ? 'her' : 'them';
    
    // Use AI to generate unique biography
    const bioPrompt = `Write a 3-4 sentence fantasy character biography for ${name}, a ${personality} ${race} ${charClass} with ${alignment} alignment from ${background.replace(/-/g, ' ')}. ${element !== 'None' ? `${pronoun.charAt(0).toUpperCase() + pronoun.slice(1)} wields ${element} magic.` : ''} Use ${pronoun}/${possessive}/${object} pronouns. Make it unique, compelling, and different from other characters. Focus on ${possessive} backstory and what drives ${object}.`;

    try {
        // Call a free AI API (using Hugging Face Inference API)
        const response = await fetch('https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.1', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                inputs: bioPrompt,
                parameters: {
                    max_new_tokens: 150,
                    temperature: 0.9,
                    top_p: 0.95,
                    do_sample: true
                }
            })
        });

        if (response.ok) {
            const data = await response.json();
            let generatedBio = data[0].generated_text.replace(bioPrompt, '').trim();
            
            // Clean up the response
            generatedBio = generatedBio.split('\n')[0]; // Take first paragraph
            generatedBio = generatedBio.replace(/^["']|["']$/g, ''); // Remove quotes
            
            if (generatedBio.length > 50) {
                return generatedBio;
            }
        }
    } catch (error) {
        console.log('AI generation failed, using fallback:', error);
    }

    // Fallback with much more variety if AI fails
    const bgDetails = {
        'ruined-city': [`${name} grew up scavenging through the crumbling ruins of a once-great city, where ${pronoun} learned that survival requires both cunning and strength.`,
                       `Born among the rubble of a destroyed metropolis, ${name} witnessed unspeakable horrors that forged ${object} into the ${charClass} ${pronoun} ${gender === 'neutral' ? 'are' : 'is'} today.`],
        'raised-by-dragons': [`${name} was found as an infant by ancient dragons who taught ${object} their ways, creating a bond between mortal and wyrm that defies nature itself.`,
                             `Raised in dragon lairs high in the mountains, ${name} learned the language of fire and fury, becoming something between human and beast.`],
        'orphan': [`${name} survived the brutal streets alone, stealing and fighting for every scrap until ${pronoun} ${gender === 'neutral' ? 'were' : 'was'} taken in by a master ${charClass}.`,
                  `Abandoned as a child, ${name} grew up in the shadows of the city, learning that trust is a luxury ${pronoun} could never afford.`],
        'noble-house': [`${name} was born into privilege but rejected ${possessive} family's corruption, choosing the path of the ${charClass} to forge ${possessive} own legacy.`,
                       `Though descended from ancient nobility, ${name} found the gilded halls suffocating and sought freedom through mastering the ${charClass} arts.`],
        'forest-wilds': [`${name} was raised by the wilderness itself, learning to speak with trees and run with wolves until ${pronoun} became more beast than mortal.`,
                        `The untamed forest shaped ${name} from birth, teaching ${object} that nature's law is the only law worth following.`],
        'monastery': [`${name} trained in isolation with monks who demanded perfection, spending years mastering ${possessive} body and mind in pursuit of enlightenment.`,
                     `High in the mountain peaks, ${name} learned discipline and deadly precision from ancient masters who saw potential in ${object}.`],
        'cursed': [`${name} carries a bloodline curse that grants ${object} terrible power at an even more terrible cost that ${pronoun} ${gender === 'neutral' ? 'know' : 'knows'} will eventually come due.`,
                  `Born under a dark omen, ${name} has spent ${possessive} life fighting against a curse that threatens to consume everything ${pronoun} ${gender === 'neutral' ? 'love' : 'loves'}.`],
        'shipwrecked': [`${name} was the sole survivor of a devastating shipwreck, washing ashore on mysterious islands where ${pronoun} discovered powers beyond mortal understanding.`,
                       `After weeks adrift at sea, ${name} emerged changed, haunted by visions that may have been divine prophecy or madness.`],
        'war-torn': [`${name} grew up on battlefields where ${pronoun} ${gender === 'neutral' ? 'were' : 'was'} forced to fight before ${pronoun} could walk, forged in blood and fire.`,
                    `The endless war took everything from ${name}, leaving only rage and the skills of a ${charClass} determined to end all conflicts.`],
        'enslaved': [`${name} broke ${possessive} chains after years of captivity, vowing that no one would ever hold power over ${object} again.`,
                    `Enslaved as a child, ${name} endured unspeakable cruelty until ${pronoun} engineered a violent escape that left ${possessive} captors dead.`],
        'exile': [`${name} was banished from ${possessive} homeland for crimes ${pronoun} may or may not have committed, now wandering as an outcast ${charClass}.`,
                 `Exiled for uncovering a conspiracy, ${name} now walks the roads alone, hunted by those who fear what ${pronoun} ${gender === 'neutral' ? 'know' : 'knows'}.`],
        'mountain-peak': [`${name} lived in isolation atop frozen peaks where the air is thin and visions come easily, learning secrets mortals were never meant to know.`,
                         `Raised by hermits in mountains so high that clouds bow beneath ${possessive} feet, ${name} descended only when destiny called.`],
        'desert-nomad': [`${name} wandered endless dunes with nomadic tribes who taught ${object} to read the stars and survive where others perish.`,
                        `Born during a sandstorm that nomads claimed was an omen, ${name} learned the desert's harsh lessons early.`],
        'underground': [`${name} dwelled in caverns so deep ${pronoun} forgot what sunlight looked like, emerging only when ${possessive} training was complete.`,
                       `Raised in underground cities carved from living rock, ${name} never saw the sky until ${pronoun} ${gender === 'neutral' ? 'were' : 'was'} already a master ${charClass}.`],
        'pirate': [`${name} sailed with pirates who valued freedom above all law, learning that morality is a luxury the desperate cannot afford.`,
                  `Raised on lawless ships, ${name} discovered that ${pronoun} ${gender === 'neutral' ? 'were' : 'was'} born for the thrill of plunder and adventure.`],
        'circus': [`${name} grew up performing in traveling shows, learning deception and acrobatics from the misfits who became ${possessive} only family.`,
                  `Born into a circus of outcasts, ${name} mastered the arts of illusion and discovered ${possessive} true calling as a ${charClass}.`],
        'haunted': [`${name} lived in a manor plagued by restless spirits who taught ${object} to see beyond the veil separating life and death.`,
                   `Growing up in a house where the dead walked freely, ${name} learned that ghosts have much to teach the living.`],
        'prophecy': [`${name} was foretold by oracles centuries before ${possessive} birth, marked by destiny for a fate ${pronoun} cannot escape.`,
                    `Ancient prophecies spoke of ${name}'s arrival, claiming ${pronoun} would either save or doom the world.`]
    };

    const origin = bgDetails[background][Math.floor(Math.random() * bgDetails[background].length)];
    
    const classJourney = [
        `Through ${possessive} journey as a ${charClass}, ${name} has become a legend whispered in taverns and feared by enemies.`,
        `${possessive.charAt(0).toUpperCase() + possessive.slice(1)} mastery of the ${charClass} arts has made ${object} both weapon and warrior, feared across the realm.`,
        `Now ${name} walks the ${alignment} path as a ${charClass}, ${possessive} reputation preceding ${object} wherever ${pronoun} ${gender === 'neutral' ? 'go' : 'goes'}.`,
        `As a ${charClass}, ${name} has carved a ${alignment} legacy that will echo through history long after ${pronoun} ${gender === 'neutral' ? 'are' : 'is'} gone.`
    ];

    const motivation = classJourney[Math.floor(Math.random() * classJourney.length)];
    
    let elementText = '';
    if (element !== 'None') {
        const elementPhrases = [
            ` ${possessive.charAt(0).toUpperCase() + possessive.slice(1)} command over ${element} magic is absolute, bending reality itself to ${possessive} will.`,
            ` The power of ${element} flows through ${possessive} veins like liquid fire, marking ${object} as something beyond mortal.`,
            ` ${pronoun.charAt(0).toUpperCase() + pronoun.slice(1)} ${gender === 'neutral' ? 'wield' : 'wields'} ${element} magic with such mastery that even other mages fear ${possessive} power.`
        ];
        elementText = elementPhrases[Math.floor(Math.random() * elementPhrases.length)];
    }

    return origin + ' ' + motivation + elementText;
}

        function generateName(gender) {
            const nameInput = document.getElementById('charName').value.trim();
            if (nameInput) return nameInput;
            
            const names = characterData.names[gender];
            return names[Math.floor(Math.random() * names.length)];
        }

        function createImagePrompt(character) {
            const raceDescriptions = {
                'human': 'human with realistic proportions and diverse features',
                'elf': 'elegant high elf with long pointed ears, sharp features, and ethereal beauty',
                'dark-elf': 'dark elf with deep purple-grey skin, white hair, and piercing eyes',
                'forest-elf': 'forest elf with earthy tones, natural features, and connection to nature',
                'dwarf': 'stout muscular dwarf with thick beard and strong build',
                'orc': 'powerful orc with green skin, prominent tusks, and fierce expression',
                'tiefling': 'tiefling with curved horns, tail, and demonic heritage features',
                'dragonborn': 'dragonborn with reptilian scales, dragon-like head, and powerful physique',
                'undead': 'undead creature with pale decaying skin, hollow eyes, and ghostly aura',
                'goblin': 'small goblin with pointed ears, sharp teeth, and cunning expression',
                'minotaur': 'massive minotaur with bull head, horns, and powerful muscular body'
            };

            const armorDescriptions = {
                'heavy-plate': 'wearing heavy ornate plate armor with intricate engravings',
                'leather': 'wearing weathered leather armor with buckles and straps',
                'robes': 'wearing flowing mystical robes adorned with arcane symbols',
                'chainmail': 'wearing gleaming chainmail armor',
                'light-armor': 'wearing light flexible armor for mobility',
                'tribal': 'wearing tribal garments with bones and feathers'
            };

            const classDetails = {
                'warrior': 'warrior stance, battle-ready, muscular build',
                'rogue': 'stealthy pose, agile build, cunning expression',
                'paladin': 'noble bearing, holy aura, righteous expression',
                'ranger': 'rugged outdoorsman, alert stance, nature connection',
                'mage': 'mystical energy surrounding them, wise expression',
                'warlock': 'dark magical energy, mysterious aura, arcane symbols',
                'cleric': 'holy light emanating, compassionate expression',
                'assassin': 'deadly grace, hidden weapons, shadowy presence',
                'druid': 'natural magic aura, primal connection, earth tones',
                'shaman': 'elemental spirits visible, tribal markings, mystical presence',
                'monk': 'disciplined stance, martial arts pose, inner peace',
                'necromancer': 'surrounded by death energy, dark aura, skeletal imagery'
            };

            const prompt = `High quality fantasy portrait, professional digital art, ${raceDescriptions[character.race]} ${character.gender}, ${classDetails[character.charClass]}, ${character.hairColor} hair, ${character.eyeColor} eyes, ${armorDescriptions[character.armorStyle]}, ${character.personality} expression, dramatic lighting, epic fantasy style, detailed texture, wielding ${character.weapon.name}, trending on artstation, 4k quality, cinematic composition, ${character.element !== 'None' ? character.element + ' magic effects' : ''}, full character portrait`;
            
            return prompt;
        }

        async function generateCharacter() {
            const gender = document.getElementById('gender').value;
            const race = document.getElementById('race').value;
            const charClass = document.getElementById('class').value;
            const alignment = document.getElementById('alignment').value;
            const hairColor = document.getElementById('hairColor').value;
            const eyeColor = document.getElementById('eyeColor').value;
            const armorStyle = document.getElementById('armorStyle').value;
            const personality = document.getElementById('personality').value.split(' - ')[0];
            const background = document.getElementById('background').value;

            const name = generateName(gender);
            const element = getElement(charClass);
            const weapon = getWeapon(charClass);
            const companion = getCompanion(charClass);
            const stats = generateStats(charClass, race);
            const abilities = generateAbilities(charClass, race, element);
            const bio = await generateBio(name, race, charClass, background, personality, alignment, element, gender);

            const character = {
                name, gender, race, charClass, alignment, element,
                hairColor, eyeColor, armorStyle, personality, background,
                weapon, companion, stats, abilities, bio
            };

            document.getElementById('displayName').textContent = name;
            document.getElementById('displayRace').textContent = race.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            document.getElementById('displayClass').textContent = charClass.charAt(0).toUpperCase() + charClass.slice(1);
            document.getElementById('displayAlignment').textContent = alignment.charAt(0).toUpperCase() + alignment.slice(1);
            document.getElementById('displayElement').textContent = element.charAt(0).toUpperCase() + element.slice(1);
            document.getElementById('statStr').textContent = stats.str;
            document.getElementById('statAgi').textContent = stats.agi;
            document.getElementById('statInt').textContent = stats.int;
            document.getElementById('statCha').textContent = stats.cha;
            document.getElementById('displayBio').textContent = bio;
            document.getElementById('displayWeapon').textContent = weapon.name;
            document.getElementById('weaponDesc').textContent = weapon.desc;

            if (companion) {
                document.getElementById('companionSection').style.display = 'block';
                document.getElementById('displayCompanion').textContent = companion.name;
                document.getElementById('companionDesc').textContent = companion.desc;
            } else {
                document.getElementById('companionSection').style.display = 'none';
            }

            const abilitiesList = document.getElementById('abilitiesList');
            abilitiesList.innerHTML = '';
            abilities.forEach(ability => {
                const div = document.createElement('div');
                div.className = 'ability-item';
                div.textContent = ability;
                abilitiesList.appendChild(div);
            });

            document.getElementById('characterInfo').style.display = 'block';

            await generatePortrait(character);
        }

        async function generatePortrait(character) {
            const portraitContainer = document.getElementById('portraitContainer');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const errorMessage = document.getElementById('errorMessage');
            
            errorMessage.classList.remove('active');
            loadingSpinner.classList.add('active');

            const prompt = createImagePrompt(character);
            console.log('Image Prompt:', prompt);

            try {
                const encodedPrompt = encodeURIComponent(prompt);
                const seed = Math.floor(Math.random() * 1000000);
                const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=768&height=1024&seed=${seed}&nologo=true`;
                
                await new Promise(resolve => setTimeout(resolve, 2000));

                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = `${character.name} portrait`;
                
                img.onload = () => {
                    portraitContainer.innerHTML = '';
                    portraitContainer.appendChild(img);
                    loadingSpinner.classList.remove('active');
                    portraitContainer.appendChild(loadingSpinner);
                };

                img.onerror = () => {
                    loadingSpinner.classList.remove('active');
                    errorMessage.textContent = 'Failed to generate portrait. Please try again.';
                    errorMessage.classList.add('active');
                };

            } catch (error) {
                loadingSpinner.classList.remove('active');
                errorMessage.textContent = 'Error generating portrait: ' + error.message;
                errorMessage.classList.add('active');
            }
        }

       async function downloadCharacter() {
    try {
        const name = document.getElementById('displayName').textContent;
        const race = document.getElementById('displayRace').textContent;
        const charClass = document.getElementById('displayClass').textContent;
        const alignment = document.getElementById('displayAlignment').textContent;
        const element = document.getElementById('displayElement').textContent;
        const weapon = document.getElementById('displayWeapon').textContent;
        const weaponDesc = document.getElementById('weaponDesc').textContent;
        const companion = document.getElementById('displayCompanion').textContent;
        const companionDesc = document.getElementById('companionDesc').textContent;
        const bio = document.getElementById('displayBio').textContent;
        const str = document.getElementById('statStr').textContent;
        const agi = document.getElementById('statAgi').textContent;
        const int = document.getElementById('statInt').textContent;
        const cha = document.getElementById('statCha').textContent;
        
        const abilities = [];
        document.querySelectorAll('.ability-item').forEach(item => {
            abilities.push(item.textContent);
        });

        // Get the portrait image URL directly (no canvas conversion)
        const portraitImg = document.querySelector('#portraitContainer img');
        const imageUrl = portraitImg ? portraitImg.src : '';

        // Create HTML with the image URL reference
        const htmlContent = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>${name} Character Card</title>
<style>
body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);color:#e0e0e0;padding:30px;margin:0}
.container{max-width:1000px;margin:0 auto}
.header{text-align:center;background:rgba(255,255,255,0.1);padding:25px;border-radius:12px;margin-bottom:25px;border:3px solid #feca57}
.title{font-size:42px;color:#feca57;font-weight:bold;margin-bottom:8px}
.subtitle{font-size:24px;color:#48dbfb;font-weight:bold}
.content{display:grid;grid-template-columns:400px 1fr;gap:25px}
.portrait{width:100%;border-radius:12px;border:4px solid #48dbfb;box-shadow:0 8px 20px rgba(0,0,0,0.6)}
.section{background:rgba(255,255,255,0.08);padding:18px;border-radius:10px;margin-bottom:18px;border-left:4px solid #feca57}
.section-title{font-size:20px;color:#feca57;font-weight:bold;margin-bottom:12px;border-bottom:2px solid rgba(254,202,87,0.5);padding-bottom:6px}
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:12px 0}
.stat-item{background:rgba(0,0,0,0.4);padding:10px;border-radius:6px;border-left:3px solid #48dbfb}
.stat-label{font-size:12px;color:#48dbfb;text-transform:uppercase}
.stat-value{font-size:18px;font-weight:bold;margin-top:3px}
.bio{line-height:1.7;font-size:14px}
.ability{background:rgba(255,107,107,0.25);padding:10px;margin:8px 0;border-radius:6px;border-left:4px solid #ff6b6b}
.weapon-box,.companion-box{background:rgba(72,219,251,0.15);padding:15px;margin:15px 0;border-radius:8px;border-left:4px solid #48dbfb}
.item-name{font-weight:bold;color:#feca57;font-size:16px;margin-bottom:6px}
.print-note{text-align:center;margin-top:25px;padding:18px;background:rgba(72,219,251,0.2);border-radius:10px;border:2px dashed #48dbfb}
@media print{.print-note{display:none}}
</style></head><body>
<div class="container">
<div class="header"><div class="title">‚öîÔ∏è ${name} ‚öîÔ∏è</div><div class="subtitle">${race} ${charClass}</div></div>
<div class="content">
<div>${imageUrl ? `<img src="${imageUrl}" alt="${name}" class="portrait">` : '<div style="background:rgba(0,0,0,0.5);padding:80px 20px;text-align:center;border-radius:12px;border:4px dashed #48dbfb">Portrait Not Available</div>'}</div>
<div>
<div class="section"><div class="section-title">üìú Character Info</div>
<div class="stat-grid">
<div class="stat-item"><div class="stat-label">Race</div><div class="stat-value">${race}</div></div>
<div class="stat-item"><div class="stat-label">Class</div><div class="stat-value">${charClass}</div></div>
<div class="stat-item"><div class="stat-label">Alignment</div><div class="stat-value">${alignment}</div></div>
<div class="stat-item"><div class="stat-label">Element</div><div class="stat-value">${element}</div></div>
</div></div>
<div class="section"><div class="section-title">üí™ Stats</div>
<div class="stat-grid">
<div class="stat-item"><div class="stat-label">Strength</div><div class="stat-value">${str}</div></div>
<div class="stat-item"><div class="stat-label">Agility</div><div class="stat-value">${agi}</div></div>
<div class="stat-item"><div class="stat-label">Intelligence</div><div class="stat-value">${int}</div></div>
<div class="stat-item"><div class="stat-label">Charisma</div><div class="stat-value">${cha}</div></div>
</div></div>
<div class="section"><div class="section-title">üìñ Biography</div><div class="bio">${bio}</div></div>
<div class="weapon-box"><div class="section-title">‚öîÔ∏è Weapon</div><div class="item-name">${weapon}</div><div>${weaponDesc}</div></div>
${companion && companion !== 'None' ? `<div class="companion-box"><div class="section-title">üêæ Companion</div><div class="item-name">${companion}</div><div>${companionDesc}</div></div>` : ''}
<div class="section"><div class="section-title">‚ú® Special Abilities</div>${abilities.map(a => `<div class="ability">${a}</div>`).join('')}</div>
</div></div>
<div class="print-note"><p style="font-size:18px;margin-bottom:8px;font-weight:bold">üí° To Save as PDF:</p><p>Press <strong>Ctrl+P</strong> (Windows) or <strong>Cmd+P</strong> (Mac)<br>Then select "Save as PDF" as your printer destination</p></div>
</div></body></html>`;

        // Create and download the file
        const blob = new Blob([htmlContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `${name.replace(/\s+/g, '_')}_Character_Card.html`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);

        // Show success message
        const errorMessage = document.getElementById('errorMessage');
        errorMessage.style.background = 'rgba(72, 219, 251, 0.2)';
        errorMessage.style.color = '#48dbfb';
        errorMessage.style.borderColor = '#48dbfb';
        errorMessage.textContent = '‚úÖ Character card downloaded! Open the HTML file and press Ctrl+P / Cmd+P to save as PDF.';
        errorMessage.classList.add('active');
        
        setTimeout(() => {
            errorMessage.classList.remove('active');
            errorMessage.style.background = 'rgba(255, 107, 107, 0.2)';
            errorMessage.style.color = '#ff6b6b';
            errorMessage.style.borderColor = '#ff6b6b';
        }, 8000);

    } catch (error) {
        console.error('Download error:', error);
        const errorMessage = document.getElementById('errorMessage');
        errorMessage.textContent = '‚ùå Error downloading: ' + error.message;
        errorMessage.classList.add('active');
    }
}
    </script>
</body>
</html>